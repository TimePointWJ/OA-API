<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.odm.oa.mapper.StaffMapper" >
  <resultMap id="BaseResultMap" type="com.odm.oa.entity.Staff">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 23 10:40:12 CST 2018.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="department_id" jdbcType="BIGINT" property="departmentId" />
    <result column="staff_no" jdbcType="VARCHAR" property="staffNo" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="position_id" jdbcType="BIGINT" property="positionId" />
    <result column="mobile_phone" jdbcType="CHAR" property="mobilePhone" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="entry_time" jdbcType="DATE" property="entryTime" />
    <result column="graduation_time" jdbcType="DATE" property="graduationTime" />
    <result column="graduation_school" jdbcType="VARCHAR" property="graduationSchool" />
    <result column="education" jdbcType="CHAR" property="education" />
    <result column="subject" jdbcType="VARCHAR" property="subject" />
    <result column="begin_development_time" jdbcType="DATE" property="beginDevelopmentTime" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="sex" jdbcType="CHAR" property="sex" />
    <result column="province_id" jdbcType="BIGINT" property="provinceId" />
    <result column="city_id" jdbcType="BIGINT" property="cityId" />
    <result column="district_id" jdbcType="BIGINT" property="districtId" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="identity_card" jdbcType="VARCHAR" property="identityCard" />
    <result column="check_status" jdbcType="CHAR" property="checkStatus" />
    <result column="status" jdbcType="CHAR" property="status" />
    <result column="update_password_flg" jdbcType="CHAR" property="updatePasswordFlg" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="del_flg" jdbcType="BIT" property="delFlg" />
    <result column="version" jdbcType="INTEGER" property="version" />
    <result column="create_id" jdbcType="VARCHAR" property="createId" />
    <result column="create_time" jdbcType="DATE" property="createTime" />
    <result column="update_id" jdbcType="VARCHAR" property="updateId" />
    <result column="update_time" jdbcType="DATE" property="updateTime" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 23 10:40:12 CST 2018.
    -->
    delete from staff
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.odm.oa.entity.Staff" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 02 10:43:29 CST 2018.
    -->
    insert into staff (id, department_id, staff_no, 
      name, position_id, mobile_phone, 
      password, entry_time, graduation_time, 
      graduation_school, education, subject, 
      begin_development_time, email, sex, 
      province_id, city_id, district_id, 
      address, identity_card, check_status, 
      status, update_password_flg, remark, 
      del_flg, version, create_id, 
      create_time, update_id, update_time
      )
    values (#{id,jdbcType=BIGINT}, #{departmentId,jdbcType=BIGINT}, #{staffNo,jdbcType=VARCHAR}, 
      #{name,jdbcType=VARCHAR}, #{positionId,jdbcType=BIGINT}, #{mobilePhone,jdbcType=CHAR}, 
      #{password,jdbcType=VARCHAR}, #{entryTime,jdbcType=DATE}, #{graduationTime,jdbcType=DATE}, 
      #{graduationSchool,jdbcType=VARCHAR}, #{education,jdbcType=CHAR}, #{subject,jdbcType=VARCHAR}, 
      #{beginDevelopmentTime,jdbcType=DATE}, #{email,jdbcType=VARCHAR}, #{sex,jdbcType=CHAR}, 
      #{provinceId,jdbcType=BIGINT}, #{cityId,jdbcType=BIGINT}, #{districtId,jdbcType=BIGINT}, 
      #{address,jdbcType=VARCHAR}, #{identityCard,jdbcType=VARCHAR}, #{checkStatus,jdbcType=CHAR}, 
      #{status,jdbcType=CHAR}, #{updatePasswordFlg,jdbcType=CHAR}, #{remark,jdbcType=VARCHAR}, 
      #{delFlg,jdbcType=BIT}, #{version,jdbcType=INTEGER}, #{createId,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=DATE}, #{updateId,jdbcType=VARCHAR}, #{updateTime,jdbcType=DATE}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.odm.oa.entity.Staff">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 02 10:43:29 CST 2018.
    -->
    update staff
    set department_id = #{departmentId,jdbcType=BIGINT},
      staff_no = #{staffNo,jdbcType=VARCHAR},
      name = #{name,jdbcType=VARCHAR},
      position_id = #{positionId,jdbcType=BIGINT},
      mobile_phone = #{mobilePhone,jdbcType=CHAR},
      password = #{password,jdbcType=VARCHAR},
      entry_time = #{entryTime,jdbcType=DATE},
      graduation_time = #{graduationTime,jdbcType=DATE},
      graduation_school = #{graduationSchool,jdbcType=VARCHAR},
      education = #{education,jdbcType=CHAR},
      subject = #{subject,jdbcType=VARCHAR},
      begin_development_time = #{beginDevelopmentTime,jdbcType=DATE},
      email = #{email,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=CHAR},
      province_id = #{provinceId,jdbcType=BIGINT},
      city_id = #{cityId,jdbcType=BIGINT},
      district_id = #{districtId,jdbcType=BIGINT},
      address = #{address,jdbcType=VARCHAR},
      identity_card = #{identityCard,jdbcType=VARCHAR},
      check_status = #{checkStatus,jdbcType=CHAR},
      status = #{status,jdbcType=CHAR},
      update_password_flg = #{updatePasswordFlg,jdbcType=CHAR},
      remark = #{remark,jdbcType=VARCHAR},
      del_flg = #{delFlg,jdbcType=BIT},
      version = #{version,jdbcType=INTEGER},
      create_id = #{createId,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=DATE},
      update_id = #{updateId,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=DATE}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time, 
    graduation_time, graduation_school, education, subject, begin_development_time, email, 
    sex, province_id, city_id, district_id, address, identity_card, check_status, status, 
    update_password_flg, remark, del_flg, version, create_id, create_time, update_id, 
    update_time
    from staff
    where id = #{id,jdbcType=BIGINT} and del_flg="0"
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time, 
    graduation_time, graduation_school, education, subject, begin_development_time, email, 
    sex, province_id, city_id, district_id, address, identity_card, check_status, status, 
    update_password_flg, remark, del_flg, version, create_id, create_time, update_id, 
    update_time
    from staff where del_flg="0"
  </select>
    
  <!-- 后台账户查询 -->
  <select id="selectStaffByStaffNo" resultMap="BaseResultMap">
    select id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time, 
    graduation_time, graduation_school, education, subject, begin_development_time, email, 
    sex, province_id, city_id, district_id, address, identity_card, check_status, status,update_password_flg, remark, del_flg, version, 
    create_id, create_time, update_id, update_time
    from staff
    where staff_no =  #{staffNo,jdbcType=VARCHAR}
    and del_flg = '0'
  </select>
  	<select id="pagination" parameterType="com.odm.oa.model.request.StaffPagination" resultType="com.odm.oa.entity.ex.StaffEx">
	    select d.name as departmentName,p.position_name as positionName,s.id, s.department_id as departmentId, s.staff_no as staffNo,
	     s.name, s.position_id as positionId, s.mobile_phone as mobilePhone ,s.password, s.entry_time as entryTime, 
	    s.graduation_time as graduationTime, s.graduation_school as graduationSchool, s.education, s.subject, 
	    s.begin_development_time as beginDevelopmentTime, s.email, s.sex,
	     s.province_id as provinceId, s.city_id as cityId, s.district_id as districtId, s.address, s.identity_card as identityCard,
	     s.check_status as checkStatus, s.status,s.update_password_flg as updatePasswordFlg, s.remark, s.del_flg as delFlg, s.version, 
	    s.create_id as createId, s.create_time as createTime, s.update_id as updateId, 
	    s.update_time as updateTime
	    from staff s
	    left join department d on s.department_id=d.id and d.del_flg="0"
	    left join position p on s.position_id=p.id and p.del_flg="0"
	    <include refid="paginationCondition"/>
  	</select>
	<sql id="paginationCondition">
        <where>
            <if test="departmentId != null and departmentId != ''">
                and s.department_id=#{departmentId}
            </if>
            <if test="positionId != null and positionId != ''">
                AND s.position_id=#{positionId}
            </if>
            <if test="checkStatus != null and checkStatus != ''">
                AND s.check_status=#{checkStatus}
            </if>
            <if test="name != null and name != ''">
                AND s.name like concat('%',concat(#{name},'%'))
            </if>
           	and s.del_flg='0'
        </where>
    </sql>
  
  <select id="selectPrivilegeByUsrId" resultType="java.lang.String" parameterType="java.lang.String">
	SELECT DISTINCT module.provilege_name
	FROM staff usr
	INNER JOIN SYSTEM_USER_ROLE usrRole
		ON usr.id = usrRole.system_account_id
		AND usr.del_flg = 0
		AND usrRole.del_flg = 0
		AND usr.staff_no = #{userId,jdbcType=VARCHAR}
	INNER JOIN SYSTEM_ROLE role
		ON role.id = usrRole.role_id
		AND role.del_flg = 0
	INNER JOIN MODULE_RIGHT auth
		ON auth.role_id = role.id
		AND auth.del_flg = 0
	INNER JOIN MODULE module
		 ON module.id = auth.module_id
		 AND module.del_flg = 0
  </select>
  
    <select id="selectStaffInfo" resultType="com.odm.oa.entity.ex.StaffEx" 
    		parameterType="com.odm.oa.model.request.StaffPagination">
	select staff.id as id, staff.department_id as departmentId, staff.staff_no as staffNo, staff.name AS name, 
		staff.position_id AS positionId, staff.mobile_phone AS mobilePhone, 
		staff.password AS password, staff.entry_time AS entryTime, staff.graduation_time AS graduationTime, 
		staff.graduation_school AS graduationSchool, staff.education AS education, 
		staff.subject AS subject, staff.begin_development_time AS beginDevelopmentTime, staff.email AS email, 
		staff.sex AS sex, staff.province_id AS provinceId, staff.city_id AS cityId, 
		staff.district_id AS districtId, staff.address AS address, staff.identity_card AS identityCard, 
		staff.check_status AS checkStatus, staff.status AS status, staff.update_password_flg as updatePasswordFlg,staff.remark AS remark, 
		d.position_name AS role
    from staff staff
    LEFT JOIN SYSTEM_USER_ROLE usrRole
		ON staff.id = usrRole.system_account_id
		AND usrRole.del_flg = 0
	LEFT JOIN SYSTEM_ROLE role 
		ON usrRole.role_id = role.id
		AND role.del_flg = 0
    LEFT JOIN position d 
        ON role.role_type = d.id
    where staff.del_flg="0"
     <if test="userIdSearch != null and userIdSearch !='' ">
      	AND staff.staff_no LIKE CONCAT(CONCAT('%',#{userIdSearch}),'%')
	 </if>
     <if test="accountKbnSearch != null and accountKbnSearch !='' ">
      	AND role.role_type = #{accountKbnSearch,jdbcType=VARCHAR}
	 </if>
  </select>
  
  <select id="selectStaffByPrimaryKey" resultType="com.odm.oa.entity.ex.StaffEx" 
    		parameterType="java.lang.Long">
    select staff.id as id, staff.department_id as departmentId, staff.staff_no as staffNo, staff.name AS name, 
		staff.position_id AS positionId, staff.mobile_phone AS mobilePhone, 
		staff.password AS password, staff.entry_time AS entryTime, staff.graduation_time AS graduationTime, 
		staff.graduation_school AS graduationSchool, staff.education AS education, 
		staff.subject AS subject, staff.begin_development_time AS beginDevelopmentTime, staff.email AS email, 
		staff.sex AS sex, staff.province_id AS provinceId, staff.city_id AS cityId, 
		staff.district_id AS districtId, staff.address AS address, staff.identity_card AS identityCard, 
		staff.check_status AS checkStatus, staff.status AS status,staff.update_password_flg as updatePasswordFlg, staff.remark AS remark, 
		d.id AS roleCode
    from staff 
    LEFT JOIN SYSTEM_USER_ROLE usrRole
		ON staff.id = usrRole.system_account_id
		AND usrRole.del_flg = 0
	LEFT JOIN SYSTEM_ROLE role 
		ON usrRole.role_id = role.id
		AND role.del_flg = 0
    LEFT JOIN position d 
        ON role.role_type = d.id 
    where staff.id =  #{staffId,jdbcType=BIGINT}
    and staff.del_flg = '0'
  </select>
  <select id="selectExByPrimaryKey" parameterType="java.lang.Long" resultType="com.odm.oa.entity.ex.StaffEx">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select s.id, s.department_id as departmentId, s.staff_no as staffNo, s.name,
	s.position_id as positionId, s.mobile_phone as mobilePhone, s.password, 
    s.entry_time as entryTime,s.graduation_time as graduationTime,
    s.graduation_school as graduationSchool, s.education, s.subject,
    s.begin_development_time as beginDevelopmentTime, s.email,s.sex, 
    s.province_id as provinceId, s.city_id as cityId, s.district_id as districtId,
    p.area_name as provinceName,c.area_name as cityName,d.area_name as districtName,
    s.address, s.identity_card as identityCard, s.check_status as checkStatus, s.status, 
    s.update_password_flg as updatePasswordFlg,s.remark, s.del_flg as delFlg, s.version, s.create_id as createId, 
    s.create_time as createTime, s.update_id as updateId, s.update_time as updateTime
    from staff s
    left join area p on p.id=s.province_id and p.del_flg='0'
    left join area c on c.id=s.city_id and c.del_flg='0'
    left join area d on d.id=s.district_id and d.del_flg='0'
    where s.id = #{id,jdbcType=BIGINT} and s.del_flg="0"
  </select>
  
  <select id="selectStaffsByDepartmentId" parameterType="java.lang.Long" resultType="com.odm.oa.entity.ex.StaffEx">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select st.id, st.department_id as departmentId, st.staff_no as staffNo, st.name, st.position_id as positionId, st.mobile_phone as mobilePhone,
     st.password, st.entry_time as entryTime,st.graduation_time as graduationTime, st.graduation_school as graduationSchool, st.education, st.subject,
      st.begin_development_time as beginDevelopmentTime, st.email, st.sex, st.province_id as provinceId, st.city_id as cityId, st.district_id as districtId,
       st.address, st.identity_card as identityCard, st.check_status as checkStatus,st.update_password_flg as updatePasswordFlg,
        st.status,st.remark, st.del_flg as delFlg, st.version, st.create_id as createId,
        st.create_time as createTime, st.update_id as updateId, st.update_time as updateTime ,p.position_name as positionName
    from staff st
    left join position p on p.id =st.position_id and p.del_flg="0" 
    where st.department_id=#{departmentId} and st.del_flg="0"
  </select>
  <select id="selectExByPositionId" parameterType="java.lang.Long" resultType="com.odm.oa.entity.ex.StaffEx">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select s.id, s.department_id as departmentId, s.staff_no as staffNo, s.name,
	s.position_id as positionId, s.mobile_phone as mobilePhone, s.password, 
    s.entry_time as entryTime,s.graduation_time as graduationTime,
    s.graduation_school as graduationSchool, s.education, s.subject,
    s.begin_development_time as beginDevelopmentTime, s.email,s.sex, 
    s.province_id as provinceId, s.city_id as cityId, s.district_id as districtId,
    p.area_name as provinceName,c.area_name as cityName,d.area_name as districtName,
    s.address, s.identity_card as identityCard, s.check_status as checkStatus, s.status, 
    s.update_password_flg as updatePasswordFlg,
    s.remark, s.del_flg as delFlg, s.version, s.create_id as createId, 
    s.create_time as createTime, s.update_id as updateId, s.update_time as updateTime
    from staff s
    left join area p on p.id=s.province_id and p.del_flg='0'
    left join area c on c.id=s.city_id and c.del_flg='0'
    left join area d on d.id=s.district_id and d.del_flg='0'
    where s.position_id = #{positionId,jdbcType=BIGINT} and s.del_flg="0"
  </select>
  
  <select id="selectByMobilePhone" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time, 
    graduation_time, graduation_school, education, subject, begin_development_time, email, 
    sex, province_id, city_id, district_id, address, identity_card, check_status, status, 
    update_password_flg,
    remark, del_flg, version, create_id, create_time, update_id, update_time
    from staff
    where mobile_phone= #{mobilePhone} and del_flg="0"
  </select>
  <select id="selectMaxStaffNo" resultType="java.lang.String">
  	select MAX(s.staff_no) from staff s where s.name!='admin' and s.del_flg="0"
  </select>
  <select id="selectStaffByQuery" parameterType="com.odm.oa.entity.ex.StaffEx" resultType="com.odm.oa.entity.ex.StaffEx">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Feb 27 17:58:41 CST 2018.
    -->
    select s.id, s.department_id as departmentId, s.staff_no as staffNo, s.name,
	s.position_id as positionId, s.mobile_phone as mobilePhone, s.password, 
    s.entry_time as entryTime,s.graduation_time as graduationTime,
    s.graduation_school as graduationSchool, s.education, s.subject,
    s.begin_development_time as beginDevelopmentTime, s.email,s.sex, 
    s.province_id as provinceId, s.city_id as cityId, s.district_id as districtId,
    p.area_name as provinceName,c.area_name as cityName,d.area_name as districtName,
    s.address, s.identity_card as identityCard, s.check_status as checkStatus, s.status, 
    s.update_password_flg as updatePasswordFlg,s.remark, s.del_flg as delFlg, s.version, s.create_id as createId, 
    s.create_time as createTime, s.update_id as updateId, s.update_time as updateTime,
    po.position_name as positionName,de.name as departmentName
    from staff s
    left join area p on p.id=s.province_id and p.del_flg='0'
    left join area c on c.id=s.city_id and c.del_flg='0'
    left join area d on d.id=s.district_id and d.del_flg='0'
    left join position po on po.id=s.position_id and po.del_flg="0"
    left join department de on de.id=s.department_id and de.del_flg="0"
    where s.del_flg="0"
    	and s.id not in (
    		select staff_id from project_staff where project_id=#{projectId}
    	)
    	 <if test="departmentId != null and departmentId !='' ">
	      	AND s.department_id=#{departmentId}
		 </if>
		 <if test="name != null and name !='' ">
	      	AND s.name like concat('%',concat(#{name},'%'))
		 </if>
  </select>
  <select id="listAuthor" resultMap="BaseResultMap">
        select STAFF.id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time,
        graduation_time, graduation_school, education, subject, begin_development_time, email,
        sex, province_id, city_id, district_id, address, identity_card, check_status, status,
        update_password_flg, remark, STAFF.del_flg, STAFF.version, STAFF.create_id, STAFF.create_time, STAFF.update_id,
        STAFF.update_time
        from staff
        inner join NOTICE on NOTICE.create_id=STAFF.staff_no and NOTICE.del_flg="0" group by name
    </select>
    <select id="listIllegalWordPerson" resultMap="BaseResultMap">
        select STAFF.id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time,
        graduation_time, graduation_school, education, subject, begin_development_time, email,
        sex, province_id, city_id, district_id, address, identity_card, check_status, status,
        update_password_flg, remark, STAFF.del_flg, STAFF.version, STAFF.create_id, STAFF.create_time, STAFF.update_id,
        STAFF.update_time
        from staff
        inner join ILLEGAL_WORD on ILLEGAL_WORD.create_id=STAFF.staff_no and ILLEGAL_WORD.del_flg="0" group by name
    </select>
    <select id="paginationPublic" parameterType="com.odm.oa.model.request.StaffPagination" resultType="com.odm.oa.entity.ex.StaffEx">
	    select count(m.send_id) as countMessage,ifnull(ap.id,"0") as privateFlg,d.name as departmentName,p.position_name as positionName,s.id, s.department_id as departmentId, s.staff_no as staffNo,
	     s.name, s.position_id as positionId, s.mobile_phone as mobilePhone ,s.password, s.entry_time as entryTime, 
	    s.graduation_time as graduationTime, s.graduation_school as graduationSchool, s.education, s.subject, 
	    s.begin_development_time as beginDevelopmentTime, s.email, s.sex,
	     s.province_id as provinceId, s.city_id as cityId, s.district_id as districtId, s.address, s.identity_card as identityCard,
	     s.check_status as checkStatus, s.status,s.update_password_flg as updatePasswordFlg, s.remark, s.del_flg as delFlg, s.version, 
	    s.create_id as createId, s.create_time as createTime, s.update_id as updateId, 
	    s.update_time as updateTime
	    from staff s
	    left join department d on s.department_id=d.id and d.del_flg="0"
	    left join position p on s.position_id=p.id and p.del_flg="0"
        left join message m on m.send_id=s.id and m.del_flg="0"  and m.read_flg="0" and m.receive_id=#{userId}
        left join address_private ap on ap.staff_id=s.id and ap.del_flg="0" and ap.staff_no=#{staffNo}
        where s.del_flg='0' and s.id!=#{userId}
        	<if test="departmentId != null and departmentId != ''">
                and s.department_id=#{departmentId}
            </if>
            <if test="positionId != null and positionId != ''">
                AND s.position_id=#{positionId}
            </if>
            <if test="checkStatus != null and checkStatus != ''">
                AND s.check_status=#{checkStatus}
            </if>
            <if test="name != null and name != ''">
                AND s.name like concat('%',concat(#{name},'%'))
            </if>
           	 group by m.send_id,s.id
           	  order by countMessage desc
  	</select>
  	<select id="paginationPrivate" parameterType="com.odm.oa.model.request.StaffPagination" resultType="com.odm.oa.entity.ex.StaffEx">
	    select count(m.send_id) as countMessage,ifnull(ap.id,"0") as privateFlg,d.name as departmentName,p.position_name as positionName,s.id, s.department_id as departmentId, s.staff_no as staffNo,
	     s.name, s.position_id as positionId, s.mobile_phone as mobilePhone ,s.password, s.entry_time as entryTime, 
	    s.graduation_time as graduationTime, s.graduation_school as graduationSchool, s.education, s.subject, 
	    s.begin_development_time as beginDevelopmentTime, s.email, s.sex,
	     s.province_id as provinceId, s.city_id as cityId, s.district_id as districtId, s.address, s.identity_card as identityCard,
	     s.check_status as checkStatus, s.status,s.update_password_flg as updatePasswordFlg, s.remark, s.del_flg as delFlg, s.version, 
	    s.create_id as createId, s.create_time as createTime, s.update_id as updateId, 
	    s.update_time as updateTime
	    from staff s
	    left join department d on s.department_id=d.id and d.del_flg="0"
	    left join position p on s.position_id=p.id and p.del_flg="0"
        left join message m on m.send_id=s.id and m.del_flg="0"  and m.read_flg="0" and m.receive_id=#{userId}
        left join address_private ap on ap.staff_id=s.id and ap.del_flg="0" and ap.staff_no=#{staffNo}
        where s.del_flg='0' and s.id!=#{userId} and ap.staff_no=#{staffNo}
        	<if test="departmentId != null and departmentId != ''">
                and s.department_id=#{departmentId}
            </if>
            <if test="positionId != null and positionId != ''">
                AND s.position_id=#{positionId}
            </if>
            <if test="checkStatus != null and checkStatus != ''">
                AND s.check_status=#{checkStatus}
            </if>
            <if test="name != null and name != ''">
                AND s.name like concat('%',concat(#{name},'%'))
            </if>
           	 group by m.send_id,s.id
           	  order by countMessage desc
  	</select>
    <select id="listReviewPerson" resultMap="BaseResultMap">
        select STAFF.id, department_id, staff_no, name, position_id, mobile_phone, password, entry_time,
        graduation_time, graduation_school, education, subject, begin_development_time, email,
        sex, province_id, city_id, district_id, address, identity_card, check_status, status,
        update_password_flg, remark, STAFF.del_flg, STAFF.version, STAFF.create_id, STAFF.create_time, STAFF.update_id,
        STAFF.update_time
        from staff
        where STAFF.position_id in (select id from POSITION where rank="2") and STAFF.del_flg=0
    </select>
    <select id="getIdByStaffNo" parameterType="java.lang.String" resultType="java.lang.Long">
        select id from STAFF where staff_no=#{no} and del_flg=0
    </select>
</mapper>