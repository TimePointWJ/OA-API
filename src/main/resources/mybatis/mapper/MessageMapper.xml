<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.odm.oa.mapper.MessageMapper">
  <resultMap id="BaseResultMap" type="com.odm.oa.entity.Message">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="message" jdbcType="VARCHAR" property="message" />
    <result column="send_id" jdbcType="BIGINT" property="sendId" />
    <result column="receive_id" jdbcType="BIGINT" property="receiveId" />
    <result column="read_flg" jdbcType="CHAR" property="readFlg" />
    <result column="send_del_flg" jdbcType="BIT" property="sendDelFlg" />
    <result column="receive_del_flg" jdbcType="BIT" property="receiveDelFlg" />
    <result column="del_flg" jdbcType="BIT" property="delFlg" />
    <result column="version" jdbcType="INTEGER" property="version" />
    <result column="create_id" jdbcType="VARCHAR" property="createId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_id" jdbcType="VARCHAR" property="updateId" />
    <result column="update_time" jdbcType="DATE" property="updateTime" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    delete from message
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.odm.oa.entity.Message">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    insert into message (id, title, message, 
      send_id, receive_id, read_flg, 
      send_del_flg, receive_del_flg, del_flg, 
      version, create_id, create_time, 
      update_id, update_time)
    values (#{id,jdbcType=BIGINT}, #{title,jdbcType=VARCHAR}, #{message,jdbcType=VARCHAR}, 
      #{sendId,jdbcType=BIGINT}, #{receiveId,jdbcType=BIGINT}, #{readFlg,jdbcType=CHAR}, 
      #{sendDelFlg,jdbcType=BIT}, #{receiveDelFlg,jdbcType=BIT}, #{delFlg,jdbcType=BIT}, 
      #{version,jdbcType=INTEGER}, #{createId,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{updateId,jdbcType=VARCHAR}, #{updateTime,jdbcType=DATE})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.odm.oa.entity.Message">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    update message
    set title = #{title,jdbcType=VARCHAR},
      message = #{message,jdbcType=VARCHAR},
      send_id = #{sendId,jdbcType=BIGINT},
      receive_id = #{receiveId,jdbcType=BIGINT},
      read_flg = #{readFlg,jdbcType=CHAR},
      send_del_flg = #{sendDelFlg,jdbcType=BIT},
      receive_del_flg = #{receiveDelFlg,jdbcType=BIT},
      del_flg = #{delFlg,jdbcType=BIT},
      version = #{version,jdbcType=INTEGER},
      create_id = #{createId,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_id = #{updateId,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=DATE}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    select id, title, message, send_id, receive_id, read_flg, send_del_flg, receive_del_flg, 
    del_flg, version, create_id, create_time, update_id, update_time
    from message
    where id = #{id,jdbcType=BIGINT} and del_flg="0"
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    select id, title, message, send_id, receive_id, read_flg, send_del_flg, receive_del_flg, 
    del_flg, version, create_id, create_time, update_id, update_time
    from message
    where del_flg="0"
  </select>
  
  	<select id="pagination" parameterType="com.odm.oa.model.request.MessagePagination" resultType="com.odm.oa.entity.ex.MessageEx">
	    select 
			m.id,m.title,m.message,m.send_id as sendId,m.receive_id as receiveId,
			m.read_flg as readFlg,m.del_flg as delFlg,m.version,
		    m.create_id as createId,m.create_time as createTime,
		    m.update_id as updateId,m.update_time as updateTime,if(st.staff_no=#{staffNo},"æˆ‘",st.name) as sendName,
		    m.send_del_flg as sendDelFlg,m.receive_del_flg as receiveDelFlg
		    from message m
		    left join staff st on st.id=m.send_id and st.del_flg="0"
		    where ((m.send_id=#{userId} and m.receive_id=#{staffId}) or (m.send_id=#{staffId} and m.receive_id=#{userId}))
		    and ((st.staff_no=#{staffNo} and m.send_del_flg="0") or(st.staff_no!=#{staffNo} and m.receive_del_flg="0"))
		    order by m.create_time
  	</select>
  	
  	<select id="selectBySendIdAndReceiveId" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 29 09:43:15 CST 2018.
    -->
    select id, title, message, send_id, receive_id, read_flg, send_del_flg, receive_del_flg, 
    del_flg, version, create_id, create_time, update_id, update_time
    from message
    where del_flg="0" and ((send_id=#{sendId} and receive_id=#{receiveId}) or (send_id=#{receiveId} and receive_id=#{sendId})) 
  </select>
</mapper>